function symlink_contents_to_dir() {
local target="$2"
mkdir -p "$target"
if [[ -f "$1" ]]; then
symlink_to_dir $1 $target
elif [[ -L "$1" ]]; then
local actual=$(readlink "$1")
symlink_contents_to_dir $actual $target
elif [[ -d "$1" ]]; then
while IFS= read -r -d '' child; do
symlink_to_dir $child $target
done < <(find "$1" -maxdepth 1 -mindepth 1 -print0)
fi
}
function symlink_to_dir() {
local target="$2"
mkdir -p "$target"
if [[ -f "$1" ]]; then
ln -s -f "$1" "$target"
elif [[ -L "$1" ]]; then
cp $1 $2
elif [[ -d "$1" ]]; then
local dirname=$(basename "$1")
mkdir -p "$target/$dirname"
while IFS= read -r -d '' child; do
symlink_to_dir $child $target/$dirname
done < <(find "$1" -maxdepth 1 -mindepth 1 -print0)
else
echo "Can not copy $1"
fi
}
symlink_contents_to_dir $SOURCE_DIR $TARGET_DIR